services:
  romm:
    image: "${IMAGE:-rommapp/romm}"
    container_name: "${NAME:-romm}"
    restart: "${RESTART:-unless-stopped}"

    labels:
      - "autoheal-app=true"
      - "autoheal"
      - "com.centurylinklabs.watchtower.enable=true"

    environment:
      - DB_HOST=romm-db
      - DB_NAME=romm
      - DB_USER=romm-user
      - HASHEOUS_API_ENABLED=true

    volumes:
      - romm_resources:/romm/resources
      - romm_redis_data:/redis-data
      - ../DATA/romm/library:/romm/library
      - ../DATA/romm/assets:/romm/assets
      - ../DATA/romm/config:/romm/config

    secrets:
      - romm_db_password
      - romm_auth_secret_key
      - screenscraper_password
      - retroachievements_api_key
      - steamgriddb_api_key

    hostname: "${NAME:-romm}"

    networks:
      host:
      media-services:

    ports:
      - "${PORT:-8080}:8080"

    depends_on:
      romm-db:
        condition: service_healthy
        restart: true

    env_file:
      - ./romm/.env

    deploy:
      replicas: 1
      # resources:
      #   limits:
      #     memory: 1G
      #     cpus: "1.00"
      #   reservations:
      #     memory: 512M
      #     cpus: "0.50"

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
