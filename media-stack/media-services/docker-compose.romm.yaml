services:
  romm:
    image: ${ROMM_IMAGE:-rommapp/romm:latest}
    container_name: ${ROMM_CONTAINER_NAME:-romm}
    restart: unless-stopped

    labels:
      - autoheal-app=true
      - keep_healthy
      - "com.centurylinklabs.watchtower.enable=false"

    environment:
      - DB_HOST=romm-db
      - DB_NAME=romm
      - DB_USER=romm-user
      - HASHEOUS_API_ENABLED=true
    
    volumes:
      - romm_resources:/romm/resources
      - romm_redis_data:/redis-data
      - ../DATA/romm/library:/romm/library
      - ../DATA/romm/assets:/romm/assets
      - ../DATA/romm/config:/romm/config

    secrets:
      - romm_db_password
      - romm_auth_secret_key
      - screenscraper_password
      - retroachievements_api_key
      - steamgriddb_api_key
    
    hostname: romm
    
    networks:
      - media-services
      - host
    
    ports:
      - ${ROMM_PORT:-8080}:8080
    
    depends_on:
      romm-db:
        condition: service_healthy
        restart: true
    
    env_file:
      - ../.env
      
    deploy:
      replicas: 1
      # resources:
      #   limits:
      #     memory: 1G
      #     cpus: "1.00"
      #   reservations:
      #     memory: 512M
      #     cpus: "0.50"