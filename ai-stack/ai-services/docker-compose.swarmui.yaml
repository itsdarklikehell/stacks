services:
  swarmui:
    image: swarmui
    container_name: swarmui
    user: ${HOST_UID:-1000}:${HOST_GID:-1000}
    restart: unless-stopped

    labels:
      - autoheal-app=true
      - keep_healthy
      - "com.centurylinklabs.watchtower.enable=false"
    
    volumes:
      - swarmdata:/SwarmUI/Data
      - swarmbackend:/SwarmUI/dlbackend
      - swarmdlnodes:/SwarmUI/src/BuiltinExtensions/ComfyUIBackend/DLNodes
      - swarmextensions:/SwarmUI/src/Extensions
      - ../DATA/swarmui/Models:/SwarmUI/Models
      - ../DATA/swarmui/Output:/SwarmUI/Output
      - ../DATA/swarmui/src/BuiltinExtensions/ComfyUIBackend/CustomWorkflows:/SwarmUI/src/BuiltinExtensions/ComfyUIBackend/CustomWorkflows

    hostname: swarmui

    networks:
      - ai-services
      - host

    ports:
      - "7801:7801"

    env_file:
      - ../.env

    cap_drop:
      - ALL

    build:
      context: ..
      args:
        UID: ${HOST_UID:-1000}
      dockerfile: swarmui/launchtools/CustomDockerfile.docker
    # uncomment `network_mode: host` if you want to access other services on the host network (eg a separated comfy instance)
    # network_mode: host

    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              # change the count to the number of GPUs you want to use.
              count: 1
              capabilities: [gpu]
