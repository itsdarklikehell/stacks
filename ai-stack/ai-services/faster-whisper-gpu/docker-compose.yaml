services:
  faster-whisper-gpu:
    image: lscr.io/linuxserver/faster-whisper:gpu
    container_name: faster-whisper-gpu
    restart: ${RESTART:-unless-stopped}

    labels:
      - autoheal-app=true
      - autoheal
      - "com.centurylinklabs.watchtower.enable=true"

    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - WHISPER_MODEL=tiny-int8
      - WHISPER_BEAM=1 #optional
      - WHISPER_LANG=en #optional
      # - LOCAL_ONLY= #optional
    
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/timezone:ro
      - faster-whisper-data/data:/config

    networks:
      host:
      ai-services:

    # ports:
    #   - "10300:10300"

    hostname: faster-whisper-gpu

    env_file:
      - ./faster-whisper-gpu/.env

    runtime: nvidia
    deploy:
      replicas: 1
      resources:
        # limits:
        #   memory: 1G
        #   cpus: "1.00"
        reservations:
          # memory: 512M
          # cpus: "0.50"
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu, compute, video, graphics, utility]

    tty: true
    
    stdin_open: true

    # # Optional: Health check for monitoring
    # healthcheck:
    #   test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3001/api/health"]
    #   interval: 30s
    #   timeout: 10s
    #   start_period: 30s
    #   retries: 3