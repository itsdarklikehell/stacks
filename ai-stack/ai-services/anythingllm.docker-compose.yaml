services:
  anythingllm:
    image: ${IMAGE:-mintplexlabs/anythingllm:latest}
    container_name: ${NAME:-anythingllm}
    restart: ${RESTART:-unless-stopped}

    labels:
      - autoheal-app=true
      - keep_healthy
      - "com.centurylinklabs.watchtower.enable=true"

    environment:
      - 'STORAGE_DIR="/app/server/storage"'

    volumes:
      - "../DATA/anythingllm/storage:${STORAGE_DIR:-/app/server/storage}"
      # - ".env.anythingllm:/app/server/.env"

    hostname: ${NAME:-anythingllm}

    user: ${PUID:-1000}:${PGID:-1000}

    command: ["--cap-add", "SYS_ADMIN"]

    # networks:
    #   - ai-services
    #   - host

    ports:
      - ${PORT:-3001}:3001

    env_file:
      - .env.anythingllm

    deploy:
      replicas: 1
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
