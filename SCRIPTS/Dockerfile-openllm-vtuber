# Gebruik een Ubuntu-gebaseerde webtop voor de beste compatibiliteit
FROM lscr.io/linuxserver/webtop:ubuntu-kde
# FROM nvidia/cuda:12.1.1-cudnn8-runtime-ubuntu22.04

# Voorkom interactieve prompts tijdens installatie
ENV DEBIAN_FRONTEND=noninteractive

# 1. Installeer Systeem-dependencies & CUDA 12.4
# Let op: De URL is specifiek gemaakt voor Ubuntu 22.04 om pakketfouten te voorkomen
RUN apt-get update && apt-get install -y gnupg2 curl && \
    curl -fsSL https://developer.download.nvidia.com | apt-key add - && \
    echo "deb https://developer.download.nvidia.com /" > /etc/apt/sources.list.d/cuda.list && \
    apt-get update && apt-get install -y \
    cuda-nvrtc-12-4 \
    cuda-cudart-12-4 \
    libcudnn8 \
    python3-pip python3-dev ffmpeg git libportaudio2 \
    && rm -rf /var/lib/apt/lists/*

# 2. Installeer 'uv' via de officiÃ«le installer
COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/

WORKDIR /app

# 3. Clone de repo en 4. Installeer dependencies met 'uv'
RUN git clone --recursive https://github.com/Open-LLM-VTuber/Open-LLM-VTuber.git . && uv pip install --system --no-cache -r requirements.txt

# 5. Maak een init-script voor de autostart
COPY autostart.sh /etc/cont-init.d/99-vtuber-start
RUN chmod +x /etc/cont-init.d/99-vtuber-start

EXPOSE 12393 3000 3001

