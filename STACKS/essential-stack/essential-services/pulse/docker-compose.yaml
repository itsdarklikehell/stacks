x-pulse-env: &pulse-env
  pulse_LOG_LEVEL: ${pulse_LOG_LEVEL:-info}
  pulse_SERVER_PORT: ${pulse_SERVER_PORT:-60072}
  pulse_DAEMON_PORT: ${pulse_DAEMON_PORT:-60073}

services:
  pulse:
    image: rcourtman/pulse:latest
    container_name: ${NAME:-pulse}
    restart: ${RESTART:-unless-stopped}

    labels:
      - com.centurylinklabs.watchtower.enable=true
      - com.ouroboros.enable=true
      - autoheal-app
      - autoheal-app=true
      - homarr-app=true
      - homarr

    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Europe/Amsterdam}

      - OAUTHLIB_RELAX_TOKEN_SCOPE=1
      - DOCKER_MODS=linuxserver/mods:universal-package-install|linuxserver/mods:universal-git|linuxserver/mods:universal-cron|lscr.io/linuxserver/mods:universal-unrar6
      # - DOCKER_HOST=
      - INSTALL_PACKAGES=libfuse2|git|gdb
      - RESTART_APP=true

    volumes:
      - /etc/localtime:/etc/localtime:ro
      # - /etc/timezone:/etc/timezone:ro
      - /var/run/docker.sock:/var/run/docker.sock

      - pulse_data:/data

    hostname: ${NAME:-pulse}

    # user: ${PUID:-1000}:${PGID:-1000}

    networks:
      host:
      essential-services:

    ports:
      - "${PORT:-7655}:7655"

    env_file:
      - ./pulse/.env

    tty: true

    stdin_open: true

    # shm_size: 1gb

    healthcheck:
      test:
        [
          CMD,
          wget,
          --quiet,
          --tries=1,
          --spider,
          http://localhost:7655/api/health,
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: 3
